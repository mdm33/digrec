require File.dirname(__FILE__) + '/../test_helper'

class ComplexTestCase < ActiveSupport::TestCase
  def setup
    unless SourceDivision.exists?(77)
      YAML.load_file(File.dirname(__FILE__) + "/complex_test.yml").each do |k, v|
        v.each do |id, attrs|
          obj = k.constantize.new
          obj.assign_attributes(attrs)
          obj.id = attrs['id']
          obj.save(:validate => false)
        end
      end
    end

    @sd = SourceDivision.find(77)
  end

  ANNOTATABLE_TOKENS = %w(267190 267193 267195 267197 267198 267203 267205
                          267208 267215 267221 267223 267226 267230 861874
                          861996 267235 267240 267242 267248 267250 267252
                          267255 267258 864033 267261 267264 267267 267269
                          267276 267279 267281 267283 267290 267291 267294
                          267297 267302 267303 267308 267312 267315 267317
                          267320 267324 267326 861047 267334 863708 267340
                          267344 267347 862391 863105 864275 267349 267353
                          267359 267364 267366 267372 267374 861997 862859
                          267379 862846 267389 267392 267394 267397 267402
                          267407 267408 267410 267411 861998 863096 863556
                          267422 267426 267430 267434 267435 863615 267439
                          267441 267442 267445 267447 267453 267456 267457
                          267461 267469 860695 861048 862727 863024 267473
                          267476 267479 1066236 793927 793932 793935 793936
                          793941 793947 793948 793952 793954 793957 860941
                          863620 793960 793963 793964 861043 267524 267530
                          267539 267542 267547 267548 267556 267561 863677
                          863707 863710 267566 267568 267573 267575 267583
                          267586 267587 860696 862455 267601 267603 267604
                          267607 267609 267611 267617 267620 267621 267625
                          267631 267633 267635 862982 863025 267637 267642
                          267645 267646 267650 863076 267656 267659 267662
                          267663 863272 267672 267676 863616 267684 267691
                          267694 861036 863711).map(&:to_i)

  def test_annotatable
    annotatable_tokens = @sd.sentences.map do |s|
      s.tokens.select { |t| t.is_annotatable? }.map(&:id)
    end.flatten

    assert_equal annotatable_tokens.sort, ANNOTATABLE_TOKENS.sort
  end
end

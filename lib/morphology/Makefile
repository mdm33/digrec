TARGETS=cu-rules.csv grc-rules.csv la-rules.csv la-generated.csv cu-normalisation.ca cu-orthographics.ca cu.ca got-rules.csv got-generated.csv

all: $(TARGETS)
	make -C class_morphology

%.a: %.fst
	fst-compiler-utf8 -q $< $@

%.ca: %.fst
	fst-compiler-utf8 -q -c $< $@

cu.fst: cu.xml class_morphology.rb class_morphology/* cu-guesser.a
	ruby -I.. class_morphology.rb cu.xml cu.fst

clean:
	rm -f $(TARGETS)
	rm -f *.db

la-rules.csv: derive la-rules.dat
	ruby -I.. derive la la-rules.dat | sort > $@ 

got-rules.csv: derive got-rules.dat
	ruby -I.. derive got got-rules.dat | sort > $@

got-generated.csv: derive-generated ../../data/morph-got.csv
	ruby -I.. derive-generated got ../../data/morph-got.csv | sort > $@

cu-rules.csv: derive cu-rules.dat
	ruby -I.. derive cu cu-rules.dat | sort > $@ 

grc-rules.csv: derive grc-rules.dat
	ruby -I.. derive --caseless grc grc-rules.dat | sort > $@

la-generated.csv: perseus-blacklist derive-generated ../../data/morph-la-open.csv 
	ruby -I.. derive-generated la ../../data/morph-la-open.csv | sort > $@

test: cu.ca
	fst-infl2 cu.ca < test.txt > test.tmp && diff -u test.tmp test.exp

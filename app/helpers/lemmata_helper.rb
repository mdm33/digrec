module LemmataHelper
  PERSEUS_BASE = 'http://www.perseus.tufts.edu'
  PERSEUS_GRC_TRANSLITERATION = {
    880 => '', # Ͱ
    881 => '', # ͱ
    882 => '', # Ͳ
    883 => '', # ͳ
    884 => '', # ʹ
    885 => '', # ͵
    886 => '', # Ͷ
    887 => '', # ͷ
    888 => '', # ͸
    889 => '', # ͹
    890 => '', # ͺ
    891 => '', # ͻ
    892 => '', # ͼ
    893 => '', # ͽ
    894 => '', # ;
    895 => '', # Ϳ
    896 => '', # ΀
    897 => '', # ΁
    898 => '', # ΂
    899 => '', # ΃
    900 => '', # ΄
    901 => '', # ΅
    902 => 'a', # Ά
    903 => '', # ·
    904 => 'e', # Έ
    905 => 'e^', # Ή
    906 => 'i', # Ί
    907 => '', # ΋
    908 => 'o', # Ό
    909 => '', # ΍
    910 => 'u', # Ύ
    911 => 'o^', # Ώ
    912 => 'i', # ΐ
    913 => 'a', # Α
    914 => 'b', # Β
    915 => 'g', # Γ
    916 => 'd', # Δ
    917 => 'e', # Ε
    918 => 'z', # Ζ
    919 => 'e^', # Η
    920 => 'th', # Θ
    921 => 'i', # Ι
    922 => 'k', # Κ
    923 => 'l', # Λ
    924 => 'm', # Μ
    925 => 'n', # Ν
    926 => 'x', # Ξ
    927 => 'o', # Ο
    928 => 'p', # Π
    929 => 'r', # Ρ
    930 => 's', # ΢
    931 => 's', # Σ
    932 => 't', # Τ
    933 => 'u', # Υ
    934 => 'ph', # Φ
    935 => 'ch', # Χ
    936 => 'ps', # Ψ
    937 => 'o^', # Ω
    938 => 'i', # Ϊ
    939 => 'u', # Ϋ
    940 => 'a', # ά
    941 => 'e', # έ
    942 => 'e^', # ή
    943 => 'i', # ί
    944 => 'u', # ΰ
    945 => 'a', # α
    946 => 'b', # β
    947 => 'g', # γ
    948 => 'd', # δ
    949 => 'e', # ε
    950 => 'z', # ζ
    951 => 'e^', # η
    952 => 'th', # θ
    953 => 'i', # ι
    954 => 'k', # κ
    955 => 'l', # λ
    956 => 'm', # μ
    957 => 'n', # ν
    958 => 'x', # ξ
    959 => 'o', # ο
    960 => 'p', # π
    961 => 'r', # ρ
    962 => 's', # ς
    963 => 's', # σ
    964 => 't', # τ
    965 => 'u', # υ
    966 => 'ph', # φ
    967 => 'ch', # χ
    968 => 'ps', # ψ
    969 => 'o^', # ω
    970 => 'i', # ϊ
    971 => 'u', # ϋ
    972 => 'o', # ό
    973 => 'u', # ύ
    974 => 'o^', # ώ
    975 => '', # Ϗ
    976 => '', # ϐ
    977 => '', # ϑ
    978 => '', # ϒ
    979 => '', # ϓ
    980 => '', # ϔ
    981 => '', # ϕ
    982 => '', # ϖ
    983 => '', # ϗ
    984 => '', # Ϙ
    985 => '', # ϙ
    986 => '', # Ϛ
    987 => '', # ϛ
    988 => '', # Ϝ
    989 => '', # ϝ
    990 => '', # Ϟ
    991 => '', # ϟ
    992 => '', # Ϡ
    993 => '', # ϡ
    994 => '', # Ϣ
    995 => '', # ϣ
    996 => '', # Ϥ
    997 => '', # ϥ
    998 => '', # Ϧ
    999 => '', # ϧ
    1000 => '', # Ϩ
    1001 => '', # ϩ
    1002 => '', # Ϫ
    1003 => '', # ϫ
    1004 => '', # Ϭ
    1005 => '', # ϭ
    1006 => '', # Ϯ
    1007 => '', # ϯ
    1008 => '', # ϰ
    1009 => '', # ϱ
    1010 => '', # ϲ
    1011 => '', # ϳ
    1012 => '', # ϴ
    1013 => '', # ϵ
    1014 => '', # ϶
    1015 => '', # Ϸ
    1016 => '', # ϸ
    1017 => '', # Ϲ
    1018 => '', # Ϻ
    1019 => '', # ϻ
    1020 => '', # ϼ
    1021 => '', # Ͻ
    1022 => '', # Ͼ
    1023 => '', # Ͽ
    7936 => 'a', # ἀ
    7937 => 'a', # ἁ
    7938 => 'a', # ἂ
    7939 => 'a', # ἃ
    7940 => 'a', # ἄ
    7941 => 'a', # ἅ
    7942 => 'a', # ἆ
    7943 => 'a', # ἇ
    7944 => 'a', # Ἀ
    7945 => 'a', # Ἁ
    7946 => 'a', # Ἂ
    7947 => 'a', # Ἃ
    7948 => 'a', # Ἄ
    7949 => 'a', # Ἅ
    7950 => 'a', # Ἆ
    7951 => 'a', # Ἇ
    7952 => 'e', # ἐ
    7953 => 'e', # ἑ
    7954 => 'e', # ἒ
    7955 => 'e', # ἓ
    7956 => 'e', # ἔ
    7957 => 'e', # ἕ
    7958 => '', # ἖
    7959 => '', # ἗
    7960 => 'e', # Ἐ
    7961 => 'e', # Ἑ
    7962 => 'e', # Ἒ
    7963 => 'e', # Ἓ
    7964 => 'e', # Ἔ
    7965 => 'e', # Ἕ
    7966 => '', # ἞
    7967 => '', # ἟
    7968 => 'e^', # ἠ
    7969 => 'e^', # ἡ
    7970 => 'e^', # ἢ
    7971 => 'e^', # ἣ
    7972 => 'e^', # ἤ
    7973 => 'e^', # ἥ
    7974 => 'e^', # ἦ
    7975 => 'e^', # ἧ
    7976 => 'e^', # Ἠ
    7977 => 'e^', # Ἡ
    7978 => 'e^', # Ἢ
    7979 => 'e^', # Ἣ
    7980 => 'e^', # Ἤ
    7981 => 'e^', # Ἥ
    7982 => 'e^', # Ἦ
    7983 => 'e^', # Ἧ
    7984 => 'i', # ἰ
    7985 => 'i', # ἱ
    7986 => 'i', # ἲ
    7987 => 'i', # ἳ
    7988 => 'i', # ἴ
    7989 => 'i', # ἵ
    7990 => 'i', # ἶ
    7991 => 'i', # ἷ
    7992 => 'i', # Ἰ
    7993 => 'i', # Ἱ
    7994 => 'i', # Ἲ
    7995 => 'i', # Ἳ
    7996 => 'i', # Ἴ
    7997 => 'i', # Ἵ
    7998 => 'i', # Ἶ
    7999 => 'i', # Ἷ
    8000 => 'o', # ὀ
    8001 => 'o', # ὁ
    8002 => 'o', # ὂ
    8003 => 'o', # ὃ
    8004 => 'o', # ὄ
    8005 => 'o', # ὅ
    8006 => '', # ὆
    8007 => '', # ὇
    8008 => 'o', # Ὀ
    8009 => 'o', # Ὁ
    8010 => 'o', # Ὂ
    8011 => 'o', # Ὃ
    8012 => 'o', # Ὄ
    8013 => 'o', # Ὅ
    8014 => '', # ὎
    8015 => '', # ὏
    8016 => 'u', # ὐ
    8017 => 'u', # ὑ
    8018 => 'u', # ὒ
    8019 => 'u', # ὓ
    8020 => 'u', # ὔ
    8021 => 'u', # ὕ
    8022 => 'u', # ὖ
    8023 => 'u', # ὗ
    8024 => '', # ὘
    8025 => 'u', # Ὑ
    8026 => '', # ὚
    8027 => 'u', # Ὓ
    8028 => '', # ὜
    8029 => 'u', # Ὕ
    8030 => '', # ὞
    8031 => 'u', # Ὗ
    8032 => 'o^', # ὠ
    8033 => 'o^', # ὡ
    8034 => 'o^', # ὢ
    8035 => 'o^', # ὣ
    8036 => 'o^', # ὤ
    8037 => 'o^', # ὥ
    8038 => 'o^', # ὦ
    8039 => 'o^', # ὧ
    8040 => 'o^', # Ὠ
    8041 => 'o^', # Ὡ
    8042 => 'o^', # Ὢ
    8043 => 'o^', # Ὣ
    8044 => 'o^', # Ὤ
    8045 => 'o^', # Ὥ
    8046 => 'o^', # Ὦ
    8047 => 'o^', # Ὧ
    8048 => 'a', # ὰ
    8049 => 'a', # ά
    8050 => 'e', # ὲ
    8051 => 'e', # έ
    8052 => 'e^', # ὴ
    8053 => 'e^', # ή
    8054 => 'i', # ὶ
    8055 => 'i', # ί
    8056 => 'o', # ὸ
    8057 => 'o', # ό
    8058 => 'u', # ὺ
    8059 => 'u', # ύ
    8060 => 'o^', # ὼ
    8061 => 'o^', # ώ
    8062 => '', # ὾
    8063 => '', # ὿
    8064 => 'a', # ᾀ
    8065 => 'a', # ᾁ
    8066 => 'a', # ᾂ
    8067 => 'a', # ᾃ
    8068 => 'a', # ᾄ
    8069 => 'a', # ᾅ
    8070 => 'a', # ᾆ
    8071 => 'a', # ᾇ
    8072 => 'a', # ᾈ
    8073 => 'a', # ᾉ
    8074 => 'a', # ᾊ
    8075 => 'a', # ᾋ
    8076 => 'a', # ᾌ
    8077 => 'a', # ᾍ
    8078 => 'a', # ᾎ
    8079 => 'a', # ᾏ
    8080 => 'e^', # ᾐ
    8081 => 'e^', # ᾑ
    8082 => 'e^', # ᾒ
    8083 => 'e^', # ᾓ
    8084 => 'e^', # ᾔ
    8085 => 'e^', # ᾕ
    8086 => 'e^', # ᾖ
    8087 => 'e^', # ᾗ
    8088 => 'e^', # ᾘ
    8089 => 'e^', # ᾙ
    8090 => 'e^', # ᾚ
    8091 => 'e^', # ᾛ
    8092 => 'e^', # ᾜ
    8093 => 'e^', # ᾝ
    8094 => 'e^', # ᾞ
    8095 => 'e^', # ᾟ
    8096 => 'o^', # ᾠ
    8097 => 'o^', # ᾡ
    8098 => 'o^', # ᾢ
    8099 => 'o^', # ᾣ
    8100 => 'o^', # ᾤ
    8101 => 'o^', # ᾥ
    8102 => 'o^', # ᾦ
    8103 => 'o^', # ᾧ
    8104 => 'o^', # ᾨ
    8105 => 'o^', # ᾩ
    8106 => 'o^', # ᾪ
    8107 => 'o^', # ᾫ
    8108 => 'o^', # ᾬ
    8109 => 'o^', # ᾭ
    8110 => 'o^', # ᾮ
    8111 => 'o^', # ᾯ
    8112 => 'a', # ᾰ
    8113 => 'a', # ᾱ
    8114 => 'a', # ᾲ
    8115 => 'a', # ᾳ
    8116 => 'a', # ᾴ
    8117 => '', # ᾵
    8118 => 'a', # ᾶ
    8119 => 'a', # ᾷ
    8120 => 'a', # Ᾰ
    8121 => 'a', # Ᾱ
    8122 => 'a', # Ὰ
    8123 => 'a', # Ά
    8124 => 'a', # ᾼ
    8125 => '', # ᾽
    8126 => '', # ι
    8127 => '', # ᾿
    8128 => '', # ῀
    8129 => '', # ῁
    8130 => 'e^', # ῂ
    8131 => 'e^', # ῃ
    8132 => 'e^', # ῄ
    8133 => '', # ῅
    8134 => 'e^', # ῆ
    8135 => 'e^', # ῇ
    8136 => 'e', # Ὲ
    8137 => 'e', # Έ
    8138 => 'e^', # Ὴ
    8139 => 'e^', # Ή
    8140 => 'e^', # ῌ
    8141 => '', # ῍
    8142 => '', # ῎
    8143 => '', # ῏
    8144 => 'i', # ῐ
    8145 => 'i', # ῑ
    8146 => 'i', # ῒ
    8147 => 'i', # ΐ
    8148 => '', # ῔
    8149 => '', # ῕
    8150 => 'i', # ῖ
    8151 => 'i', # ῗ
    8152 => 'i', # Ῐ
    8153 => 'i', # Ῑ
    8154 => 'i', # Ὶ
    8155 => 'i', # Ί
    8156 => '', # ῜
    8157 => '', # ῝
    8158 => '', # ῞
    8159 => '', # ῟
    8160 => 'u', # ῠ
    8161 => 'u', # ῡ
    8162 => 'u', # ῢ
    8163 => 'u', # ΰ
    8164 => 'r', # ῤ
    8165 => 'r', # ῥ
    8166 => 'u', # ῦ
    8167 => 'u', # ῧ
    8168 => '', # Ῠ
    8169 => '', # Ῡ
    8170 => '', # Ὺ
    8171 => '', # Ύ
    8172 => '', # Ῥ
    8173 => '', # ῭
    8174 => '', # ΅
    8175 => '', # `
    8176 => '', # ῰
    8177 => '', # ῱
    8178 => 'o^', # ῲ
    8179 => 'o^', # ῳ
    8180 => 'o^', # ῴ
    8181 => '', # ῵
    8182 => 'o^', # ῶ
    8183 => 'o^', # ῷ
    8184 => 'o', # Ὸ
    8185 => 'o', # Ό
    8186 => 'o^', # Ὼ
    8187 => 'o^', # Ώ
    8188 => 'o^', # ῼ
    8189 => '', # ´
    8190 => '', # ῾
    8191 => '', # ῿
  }

  def utf8_to_perseus(s)
    s.unpack("U*").collect { |c| PERSEUS_GRC_TRANSLITERATION[c] }.join('')
  end

  def perseus_url(lemma)
    if lemma.language == 'la' or lemma.language == 'grc'
      if lemma.language == 'grc'
        lang = 'greek'
      else
        lang = 'latin'
      end

      l = lemma.perseus_lemma ? lemma.perseus_lemma : lemma.lemma
      l = utf8_to_perseus(l) if lang == 'greek'
      l.gsub!(/\^/, '%5E')

      f = "/cgi-bin/resolveform?lookup=#{l}&lang=#{lang}&type=exact"

      escape_once(PERSEUS_BASE + f)
    else
      nil
    end
  end

  def format_abbreviated_sentence(tokens, limit = 5)
    format_sentence(tokens, :length_limit => limit)
  end

  def link_to_relation(value, options = {})
    if value.is_a?(Token)
      relation = value.relation
    else
      relation = value
    end
    readable_relation(relation)
  end
  
  def link_sentence(sentence, text = nil)
    text ||= sentence.sentence_number
    link_to text, { :controller => 'dependencies', :action => 'show', :id => sentence }, { :class => 'sentence' }
  end
end

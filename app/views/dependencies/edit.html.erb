<% javascript "utils", "relations", "tree", "dependencies" %>
<% stylesheet "dependencies" %>

<%= render :partial => 'shared/location', :locals => { :sentence => @sentence, :title => 'Annotation', :value => 'Dependency structure', :edit_url => :edit_annotation_dependencies_url } %>

<div id="annotation" class="annotation">
  <%= hidden_field_tag 'input-tokens', @tokens.to_json %>
  <%= hidden_field_tag 'input-structure', @structure.to_json %>
  <%= hidden_field_tag 'input-relations', @relations.to_json %>

  <div class="actions">
    <%= button_to_function "Delete subtree", :id => 'button-delete', :disabled => true %>
    <%= button_to_function "Cut subtree", :id => 'button-cut', :disabled => true %>
    <%= button_to_function "Paste subtree", :id => 'button-paste', :disabled => true %>
    <%= button_to_function "Clear", :id => "button-clear" %>
    <%= button_to_function "Reset", :id => "button-reset" %>
    <%= button_to_function "Add asyndetic conjunction", :id => "button-insert-empty-conjunction-node" %>
    <%= button_to_function "Add empty verbal node", :id => "button-insert-empty-verbal-node" %>
    <%= button_to_function "Add slash", :id => 'button-add-slash', :disabled => true %>
    <%= button_to_function "Remove slashes", :id => 'button-remove-slashes', :disabled => true %>
  </div>

  <div class="actions">
    <label>Build direction</label>
    <%= radio_button_to_function "direction", "down", true, "onChangeDirectionClick()", :id => 'build-down' %> Downwards
    <%= radio_button_to_function "direction", "up", false, "onChangeDirectionClick()", :id => 'build-up' %> Upwards 
  </div>

  <div id="palette">
    <% @relations.each do |v| %>
      <label for="<%= v %>">
        <input type="radio" name="relation-palette" id="<%= v %>" value="<%= v %>"></input>
        <span><%= readable_relation(v) %></span>
      </label>
    <% end %>
  </div>

  <div id="words">
    <% @sentence.tokens.morphology_annotatable.each do |t| %>
      <label for="word-<%= t.id %>">
        <input type="radio" name="token-palette" id="word-<%= t.id %>" value="<%= t.id %>"></input>
        <span><span class="form"><%= format_token_form(t) %></span><span class="token-number"><%= t.token_number %></span></span>
      </label>
    <% end %>
  </div>

  <!-- FIXME: the lang attribute here is a work-around. This will break if
       LangText is ever extended beyond simple language attribute handling. -->
  <ul id="relations" lang="<%= @sentence.language.iso_code %>" class="tree"></ul>

  <div class="actions">
    <% form_tag({ :controller => 'dependencies', :action => 'update', :annotation_id => @sentence, :wizard => params[:wizard]}, :method => :put, :id => 'dependencies-form') do -%>
      <%= hidden_field_tag 'output', '' %>
      <%= submit_tag 'Save' %>
    <% end %>
  </div>

  <%= wizard_options(nil, params[:wizard]) %>
</div>

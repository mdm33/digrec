= The PROIEL web application

The PROIEL web application used the Ruby on Rails framework. If you are
unfamiliar with this, you should consulta general introduction to Ruby on
Rails first. link:http://rubyonrails.org/ and
linkhttp://guides.rubyonrails.org/ are good starting points. Note that this
version of the PROIEL web application requires Rails 2.3.x.

== Installation

If you already have Ruby, RubyGems and Ruby on Rails installed,
installation of the PROIEL web application consist of the following steps.

=== Step 1: Dependencies

The application has a number of other dependencies that should be handled
automatically by Rails' dependency tracker. Use

    rake gems:install

to have the dependency tracker automatically install all dependencies.

You should also install +graphviz+ from link:http://www.graphviz.org/ to
get dependency graph visualisations. Version 2.26.3 is known to work with
this release of the PROIEL application, but more recent versions should
also work. +graphviz+ must be compiled with SVG support. The recommended
configuration settings are

    --with-fontconfig --with-freetype2 --with-pangocairo --with-rsvg

=== Step 2: Generate support files

Before starting the application for the first time, you must run
    make -C lib
to build the support files.

== Step 3: Configure the database

Copy +config/database.yml.example+ to +config/database.yml+ and customize
if needed. The default setup creates SQLite databases in the +db+
directory.

Initialize a new database by running

    $ rake db:setup

Add an administrator account. This should be done using Rails' console
interface:

    $ ./script/console
    Loading development environment (Rails 2.3.8)
    >> u = User.new :login => "username", :first_name => "Foo", :last_name => "Bar", :email => "foo@bar", :password => "foo"
    >> u.role_id = 4
    >> u.save!
    >> u.confirm!

=== Step 4: Set run-time configuration settings

Inspect +config/app_config.yml+ and make changes as necessary. It is
essential that you change the +base_url+ and the +dc_*+ fields.

=== Step 5 (optional): Enable morphological rules

If you plan to compile your own morphological rules, you will need the
+SFST+ toolkit from
link:http://www.ims.uni-stuttgart.de/projekte/gramotron/SOFTWARE/SFST.html.
This release of the PROIEL web application is designed to work with version
1.3 of +SFST+.

== License

The PROIEL web application is licensed under the terms of the GNU General
Public License version 2. See the file +COPYING+ for details.

The application was written by Marius L. Jøhndal (University of Cambridge),
Dag Haug (University of Oslo) and Anders Nøklestad (University of Oslo).

== Modifying the application

This details some ways in which you may want to modify or extend the
application.

=== Adding a dependency graph visualization method

The default supported visualization method uses +graphviz+. As long as you
are able to use the +dot+ engine from +graphviz+, adding new visualizations
is trivial:

  1. Create a new visualization template in +lib/graph_visualization/+.
     Have a look at the existing ones to see how the system works.
  2. Add a new visualization choice in
     +app/views/preferences/edit.html.haml+. This will enable users to select
     the visualization method.
  3. Add a new description of the visualization method in +config/locales/en.yml+.

Early testing of new visualisations is probably best done using the Rails
console. To see the +dot+ file produced before it is passed to +graphviz+,
you can try the following:

    $ ./script/console
    Loading development environment (Rails 2.3.11)
    >> puts Visualization.new(Sentence.find(47625)).generate(:format => :dot,
           :mode => :linearized)

To run it through +graphviz+, try changing the format to +svg+, which in
this case revealed a syntax error in the generated +dot+ file.

    >> Visualization.new(Sentence.find(47625)).generate(:format => :svg,
          :mode => :linearized)
    VisualizationError: graphviz exited: Error: <stdin>:6: syntax error near
    line 6
    context:     depthR [style=invis] >>>  -> <<<

      from /home/mlj/src/proiel/lib/graph_visualization.rb:70:in `generate'
        from (irb):1
